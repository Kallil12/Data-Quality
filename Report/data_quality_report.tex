\documentclass[a4paper, 12pt]{article}

\usepackage[english]{babel}
%\usepackage[portuges]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{indentfirst}
\usepackage{graphicx}
\usepackage{multicol,lipsum}
%\renewcommand{\figurename}{Figura}
\usepackage{hyperref}
\usepackage{rotating}
\usepackage{lscape}

\setlength{\parskip}{1em}

\begin{document}
%\maketitle

\begin{titlepage}
	\begin{center}
	
	%\begin{figure}[!ht]
	%\centering
	%\includegraphics[width=2cm]{c:/ufba.jpg}
	%\end{figure}

		\textbf{\Large{BRP Report}}\\
		\large{Data Quality Analyst}\\ 
		%\large{Programa}\\ 
		\vspace{15pt}
        \vspace{95pt}
        %\textbf{\large{Rascunho PEP}}\\
		%\title{{\large{TÃ­tulo}}}
		\vspace{3,5cm}
	\end{center}
	
	\begin{flushleft}
		\begin{tabbing}
			Kallil de Araujo Bezerra \\
	\end{tabbing}
 \end{flushleft}
	\vspace{1cm}
	
	\begin{center}
		\vspace{\fill}
			\today
	\end{center}
\end{titlepage}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% % % % % % % % %FOLHA DE ROSTO % % % % % % % % % %

% % % % % % % % % % % % % % % % % % % % % % % % % %
\newpage
\tableofcontents
\thispagestyle{empty}

\newpage
\pagenumbering{arabic}
% % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Task 1}

The first part of the assignment is to read the data sent and do a quick analysis, to understand what this data is about. There are two files, both in \textit{.csv} format.


- Date fixes: the data in both files present some date inconsistencies. For example, they use '-' and '/' to separate month, day, and year. This may cause some confusion when a script tries to determine what type of data the file has.

- Special Character fixes: in order to keep the data consistent, it's important to change some special characters. When sending data between different systems, so from a Microsoft Server to a Power BI dashboard, or to a .csv file it's important to have the data to be shown the same way, this cannot be guaranteed if special characters are involved. Therefore, a special character removal is an important step to keep consistency.

- Data validation: it is important to check if all our data is valid. For example, checking if all cities in 'CITY\_DEALER' are cities that do exist and also are cities in which BRP has a dealer. The same should be applied to to 'STATE\_CODE'. Another step is to make sure that the cities follow a standard and are not duplicated. We can find 'Alexandria Bay' and 'Alexandria Bay,', despite being the same city, it could be considered 2 different cities without a data cleansing.

- Check for duplicated records: duplicated records can affect how managers will take their decisions because they may represent the same event twice. This can come in two different ways, either by having 2 identical records on the dataset, or by having 2 different records that represent the same thing. The last one can be caused by problems like cities with different names but that represent the same place, similar to what was described in the previous topic.

- Check for missing values in critical columns: check if there aren't any missing values in ID columns for example. In the files under analysis I believe that 'REG\_DEALER\_NUMBER' and 'MODEL\_NUMBER' are important columns that can't have null or empty values, therefore it's important to check if they are complete.

Date Standardization: Ensure consistent date formats by converting all date entries to a standardized format (e.g., YYYY-MM-DD). This standardization prevents format-related issues when processing the data.

Special Character Cleanup: Remove special characters from data entries to maintain consistency when transferring data across different systems, such as from a Microsoft Server to Power BI or a CSV file.

Data Validation and Standardization: Perform data validation to verify the accuracy and consistency of location-related data. Ensure that cities and state codes are valid, adhere to standard naming conventions, and eliminate duplicated or similar but distinct entries (e.g., 'Alexandria Bay' and 'Alexandria Bay,') to avoid data duplication.

Duplicate Record Detection: Detect and handle duplicated records, which can distort analysis and decision-making. This can involve identifying identical records or reconciling records representing the same entity with variations in data entry.

Missing Value Assessment: Check critical columns for missing values. Columns such as 'REG\_DEALER\_NUMBER' and 'MODEL\_NUMBER' should be complete, as they are important identifiers. Address any null or empty values to maintain data integrity.

\begin{itemize}
    \item item 1
    \item item 2
    \item item 3
      \begin{itemize}
          \item sub item 1 
          \item sub item 2
          \item sub item 3
    \end{itemize}
    \item item 4
        \begin{enumerate}
            \item passo 1
            \item passo 2
            \item passo 3
        \end{enumerate}
\end{itemize}

\newpage
\subsection{Most expensive products at the company}

To analyze the most expensive products in the schema, it was necessary to order them by their prices. From most to less expensive. The query used can be seen below. The \textbf{LIMIT 11} was used because the last products cost the same (315.90), so I considered both as the $10^{th}$ position.

\begin{verbatim}
    SELECT PRODUCT_NAME, PRODUCT_VAL
    FROM looqbox_challenge.data_product
    ORDER BY PRODUCT_VAL DESC
    LIMIT 11;
\end{verbatim}

The result can be seen in the image \ref{fig_texto_jogo} or in the table \ref{tab:prod_prices}.

\begin{figure}[htb]
	\caption{\label{fig_texto_jogo} Data from task 1}
	\begin{center}
		\includegraphics[scale=1.10]{task_1_sql.PNG}
	\end{center}
\end{figure}


\newpage

I tried to execute another query, using \textbf{RANK}. However, it did not work because of a server version issue. I am not sure why. The \textit{better} query is the one below, it is more elegant than the one I presented.

\begin{verbatim}
SELECT RANK() OVER(ORDER BY PRODUCT_VAL DESC) ranked_products,
       PRODUCT_NAME,
       PRODUCT_VAL
FROM looqbox_challenge.data_product
WHERE ranked_products < 10;
\end{verbatim}
\newpage
\subsection{Sections from selected departments}

In the next task it is asked to analyze which sections the departments \textbf{BEBIDAS} and \textbf{PADARIA} have. To do this, the following query was written.

\begin{verbatim}
    SELECT DISTINCT SECTION_NAME, SECTION_COD, DEP_NAME
    FROM looqbox_challenge.data_product
    WHERE (DEP_NAME LIKE 'BEBIDAS%' OR DEP_NAME LIKE 'PADARIA%')
    ORDER BY DEP_NAME;
\end{verbatim}

The result can be seen in the table \ref{tab:sections_table}.

\begin{table}[htb]
\centering
\begin{tabular}{lcc}
\hline
\# SECTION\_NAME   & \multicolumn{1}{l}{SECTION\_COD} & \multicolumn{1}{l}{DEP\_NAME} \\ \hline
BEBIDAS            & 4                                & BEBIDAS                       \\ \hline
CERVEJAS           & 29                               & BEBIDAS                       \\ \hline
VINHOS             & 30                               & BEBIDAS                       \\ \hline
REFRESCOS          & 31                               & BEBIDAS                       \\ \hline
DOCES-E-SOBREMESAS & 8                                & PADARIA                       \\ \hline
PADARIA            & 19                               & PADARIA                       \\ \hline
QUEIJOS-E-FRIOS    & 22                               & PADARIA                       \\ \hline
GESTANTE           & 27                               & PADARIA                       \\ \hline
\end{tabular}
\caption{Department and section analysis}
\label{tab:sections_table}
\end{table}

\newpage
\subsection{Total sales in 2019}
In this analysis it was assumed that Business Area could be interpreted as \textbf{BUSINESS\_NAME}.

\begin{verbatim}
    SELECT BUSINESS_NAME, SUM(SALES_VALUE)
    FROM looqbox_challenge.data_store_sales d_sales
    INNER JOIN looqbox_challenge.data_store_cad d_cad 
               ON d_cad.STORE_CODE = d_sales.STORE_CODE
    WHERE DATE BETWEEN '2019-01-01' AND '2019-04-01'
    GROUP BY BUSINESS_NAME;
\end{verbatim}

The result of this query can be seen in table \ref{tab:total_sales}. This option is ordered by the business' name. Another way to see the results is shown in the table \ref{tab:total_sales_ordered}, which is ordered by \textbf{SALES\_VALUE}, therefore the ones with highest sales value will come first.

\begin{table}[htb]
\centering
\begin{tabular}{cr}
\hline
\multicolumn{1}{l}{\# BUSINESS\_NAME} & \multicolumn{1}{l}{SUM(SALES\_VALUE)} \\ \hline
Atacado                               & 81079295.20                           \\ \hline
Farma                                 & 82462460.37                           \\ \hline
Posto                                 & 32338509.96                           \\ \hline
Proximidade                           & 80863761.30                           \\ \hline
Varejo                                & 81733342.62                           \\ \hline
\end{tabular}
\caption{Total sales by business area in the first quarter of 2019}
\label{tab:total_sales}
\end{table}

\begin{table}[htb]
\centering
\begin{tabular}{cr}
\hline
\# BUSINESS\_NAME & SUM(SALES\_VALUE) \\ \hline
Posto             & 32338509.96       \\ \hline
Proximidade       & 80863761.30       \\ \hline
Atacado           & 81079295.20       \\ \hline
Varejo            & 81733342.62       \\ \hline
Farma             & 82462460.37       \\ \hline
\end{tabular}
\caption{Total sales by business area in the first quarter of 2019 - ordered by sales value}
\label{tab:total_sales_ordered}
\end{table}

\newpage



\section{Case 1 - Dynamic Function}



\newpage
\section{Case 2 - Join queries}

Two different queries were given, and I was asked to not modify the queries. The result must be in the following format: \textbf{Loja}, \textbf{Categoria}, and \textbf{TM}. 

\begin{verbatim}
SELECT store_cad.STORE_NAME AS Loja, 
       store_cad.BUSINESS_NAME AS Categoria, 
       ROUND((store_sales.SALES_VALUE/store_sales.SALES_QTY),2) AS TM
FROM(
SELECT
      STORE_CODE,
      STORE_NAME,
      START_DATE,
      END_DATE,
      BUSINESS_NAME,
      BUSINESS_CODE
FROM looqbox_challenge.data_store_cad
) AS store_cad
JOIN (
SELECT
        STORE_CODE,
        DATE,
        SALES_VALUE,
        SALES_QTY
FROM looqbox_challenge.data_store_sales
WHERE DATE BETWEEN '2019-01-01' AND '2019-12-31'
) AS store_sales ON store_sales.STORE_CODE = store_cad.STORE_CODE
GROUP BY store_cad.STORE_NAME
ORDER BY store_cad.STORE_NAME;
\end{verbatim}


\newpage
\section{Case 3 - Data visualization}


\newpage
\end{document}



